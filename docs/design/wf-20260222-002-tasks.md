# タスク分解: UIコンポーネント化最適化 - Storybook導入 + ドキュメント整備

**WorkflowID**: wf-20260222-002
**作成日**: 2026-02-22
**Mode**: existing-modification

---

## Slices

| Slice | 名称 | 依存 |
|-------|------|------|
| 1 | Storybook基盤導入 | - |
| 2 | Stories作成（全コンポーネント） | Slice 1 |
| 3 | ドキュメント整備 | Slice 2 |

---

## Slice 1: Storybook基盤導入

| # | タスク | ファイル | 説明 |
|---|--------|---------|------|
| 1-1 | Storybook 10インストール | package.json | `npx storybook@latest init` でインストール |
| 1-2 | .storybook/main.ts カスタマイズ | .storybook/main.ts | stories glob, framework, addons, staticDirs設定 |
| 1-3 | .storybook/preview.ts 作成 | .storybook/preview.ts | globals.css + フォントデコレータ設定 |
| 1-4 | scripts確認 | package.json | storybook, build-storybook スクリプト確認 |
| 1-5 | .gitignore更新 | .gitignore | storybook-static追加 |
| 1-6 | 動作確認 | - | `npm run storybook` でポート6006起動確認 |

### .storybook/main.ts 仕様

```typescript
import type { StorybookConfig } from "@storybook/nextjs";

const config: StorybookConfig = {
  stories: ["../src/**/*.stories.@(js|jsx|mjs|ts|tsx)"],
  addons: [
    "@storybook/addon-essentials",
    "@storybook/addon-interactions",
  ],
  framework: {
    name: "@storybook/nextjs",
    options: {},
  },
  staticDirs: ["../public"],
};

export default config;
```

### .storybook/preview.ts 仕様

```typescript
import type { Preview } from "@storybook/react";
import "../src/app/globals.css";

const preview: Preview = {
  parameters: {
    controls: {
      matchers: {
        color: /(background|color)$/i,
        date: /Date$/i,
      },
    },
    nextjs: {
      appDirectory: true,
    },
  },
  decorators: [
    (Story) => {
      // Google Fontsのフォールバック（CSS変数を設定）
      return (
        <div
          style={{
            '--font-mplus1': 'sans-serif',
            '--font-mincho': 'serif',
            '--font-noto': 'sans-serif',
          } as React.CSSProperties}
        >
          <Story />
        </div>
      );
    },
  ],
};

export default preview;
```

---

## Slice 2: Stories作成

### 優先度: 高（Props付きコンポーネント）

| コンポーネント | Storiesファイル | バリアント |
|---------------|----------------|-----------|
| Header | src/components/Header.stories.tsx | Default, Paper, Editorial |
| Contact | src/components/Contact.stories.tsx | Default |
| BackgroundTriangles | src/components/BackgroundTriangles.stories.tsx | 各pattern |
| CountUp | src/components/CountUp.stories.tsx | Default, LargeNumber |
| charts/PopulationChart | src/components/charts/PopulationChart.stories.tsx | モックデータ |
| charts/AgeDistributionChart | src/components/charts/AgeDistributionChart.stories.tsx | モックデータ |
| charts/ElderlyRateTrendChart | src/components/charts/ElderlyRateTrendChart.stories.tsx | モックデータ |
| recruit/ModelIncomeSection | src/components/recruit/ModelIncomeSection.stories.tsx | Nurse, Therapist |

### 優先度: 中（セクションコンポーネント）

| コンポーネント | Storiesファイル |
|---------------|----------------|
| Hero | src/components/Hero.stories.tsx |
| About | src/components/About.stories.tsx |
| Features | src/components/Features.stories.tsx |
| Flow | src/components/Flow.stories.tsx |
| FAQ | src/components/FAQ.stories.tsx |
| Office | src/components/Office.stories.tsx |
| Staff | src/components/Staff.stories.tsx |

### 優先度: 低（残りコンポーネント）

| コンポーネント | Storiesファイル | 備考 |
|---------------|----------------|------|
| Recruit | src/components/Recruit.stories.tsx | |
| Company | src/components/Company.stories.tsx | |
| Footer | src/components/Footer.stories.tsx | |
| FloatingRecruitBanner | src/components/FloatingRecruitBanner.stories.tsx | スクロール連動系 |
| ScrollToTop | src/components/ScrollToTop.stories.tsx | スクロール連動系 |
| recruit/JobDetails | src/components/recruit/JobDetails.stories.tsx | recruit-dataからモック |

### Storybookに含めないもの

- GoogleAnalytics（UIなし）
- StructuredData（UIなし）
- UpdatesPopup（無効化中）

---

## Slice 3: ドキュメント整備

| # | タスク | ファイル |
|---|--------|---------|
| 3-1 | COMPONENTS.md更新: 未掲載7コンポーネント追加 | docs/COMPONENTS.md |
| 3-2 | COMPONENTS.md更新: 全Props仕様記載 | docs/COMPONENTS.md |
| 3-3 | COMPONENTS.md更新: useScrollAnimationフック追加 | docs/COMPONENTS.md |
| 3-4 | COMPONENTS.md更新: CSSクラスガイド追加 | docs/COMPONENTS.md |
| 3-5 | CLAUDE.md更新: コンポーネント参照ガイダンス追加 | CLAUDE.md |
| 3-6 | COMPONENT-OPTIMIZATION.md作成: 重複パターンリスト | docs/COMPONENT-OPTIMIZATION.md |

### CLAUDE.mdに追加する内容

```markdown
## コンポーネント参照ガイドライン

### 新規UI実装前の必須チェック
1. `docs/COMPONENTS.md` を読んで既存コンポーネントを確認する
2. `npm run storybook` で視覚確認する（ポート6006）
3. `docs/COMPONENT-OPTIMIZATION.md` で重複パターンを確認する

### 再利用必須コンポーネント
- `BackgroundTriangles` - セクション背景装飾
- `CountUp` - 数値カウントアップ
- `StructuredData` 系 - SEO構造化データ
- charts/ 系 - グラフ・チャート
- `useScrollAnimation` - スクロール連動アニメーション

### セクション実装パターン
\`\`\`tsx
<section className="relative overflow-hidden">
  <BackgroundTriangles pattern="[section-name]" />
  <div className="section-wrapper">
    <div className="section-inner">
      {/* コンテンツ */}
    </div>
  </div>
</section>
\`\`\`
```

### 未掲載7コンポーネント（COMPONENTS.md追加対象）

| コンポーネント | Props | 説明 |
|---------------|-------|------|
| FloatingRecruitBanner | なし | スクロール連動フローティングバナー |
| ScrollToTop | なし | ページトップへ戻るボタン |
| UpdatesPopup | なし | 更新通知ポップアップ（localStorage連携） |
| charts/PopulationChart | data, areaName, primaryColor?, secondaryColor? | 人口推移折れ線グラフ |
| charts/AgeDistributionChart | data, primaryColor?, secondaryColor?, accentColor? | 年齢分布円グラフ |
| charts/ElderlyRateTrendChart | data, primaryColor?, gradientId? | 高齢化率推移エリアチャート |
| recruit/ModelIncomeSection | isNurse: boolean | モデル年収セクション |

---

## 整合性チェックリスト

- [ ] 既存コンポーネントの動作を変更しない
- [ ] package.jsonのdependencies（本番）に影響しない（devDependenciesのみ）
- [ ] `npm run build` が引き続き成功する
- [ ] Firebase Hostingデプロイに影響しない
- [ ] ESLint設定との互換性

---

## Verification

1. `npm run storybook` でStorybook 10がポート6006で起動する
2. Storybook上でCSS変数・Tailwindクラスが正しく描画される
3. Header/Contact等のProps付きコンポーネントがControls panelで操作できる
4. `npm run build` が引き続き成功する（本番ビルドに影響なし）
5. `npm run lint` がエラーなし
6. docs/COMPONENTS.mdに25コンポーネント全てが記載されている
7. CLAUDE.mdにコンポーネント参照ガイダンスが追加されている
